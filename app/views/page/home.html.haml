= content_for :js do
  = javascript_tag do
    $(document).ready(function(){
    if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showMap);
    }
    });

    function showMap(position){
    var mapOptions = {
    center: new google.maps.LatLng(position.coords.latitude,position.coords.longitude),
    zoom: 15,
    minZoom: 13,
    mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    var fullBounds = new google.maps.LatLngBounds();    
    map = new google.maps.Map($('#map-canvas')[0] ,mapOptions);

    new google.maps.Marker({
    animation: google.maps.Animation.DROP,
    position: map.getCenter(),
    map: map,
    icon: "#{image_path("marker.png")}"
    });

    - Station.find_each do |station|
      var latLng = new google.maps.LatLng("#{station.latitude}", "#{station.longitude}");
      fullBounds.extend(latLng);
      marker = new google.maps.Marker({
      animation: google.maps.Animation.DROP,
      position: latLng,
      map: map
      });
      // Adiciona um evento (clique) ao marcador
      var infowindow = new google.maps.InfoWindow({ content: '' });
      var id = parseInt("#{station.id}");
      google.maps.event.addListener(marker, 'click', (function(id) {
      return function() {
      infowindow.setContent("<b>Name: </b>#{station.name}<br/><b>Price: </b> R$ 3,199");
      infowindow.open(map, this);
      }
      })(id));

    map.fitBounds(fullBounds);

    }

%h4.text-center Find a gas station

-# %p= image_tag 'http://placehold.it/1050x500'
#map-canvas

.row
  .large-4.columns.text-center
    = fa_icon('map-o 5x')
    %br
    Wherever
  .large-4.columns.text-center
    = fa_icon('money 5x')
    %br
    Cheapest
  .large-4.columns.text-center
    = fa_icon('map-marker 5x')
    %br
    Closer
